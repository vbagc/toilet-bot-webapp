<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Toilet Bot Camera</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: sans-serif; padding: 1rem; text-align: center }
    button { font-size: 1.25rem; padding: 0.5rem 1rem; margin: 1rem; }
    #capture { display: none; }
    #status { margin-top: 2rem; }
    video, img { max-width: 100%; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>üöª Toilet-Bot Camera</h1>
  <div id="status">‚ùì Please enable location</div>

  <!-- 1) Ask for location -->
  <button id="enableLoc">Enable Location</button>

  <!-- 2) Once location is OK, let them take a picture -->
  <input
    type="file"
    accept="image/*"
    capture="environment"
    id="capture"
  />

  <!-- Preview -->
  <video id="preview" autoplay playsinline style="display:none;"></video>
  <img id="snapshot" />

  <script>
    const statusEl = document.getElementById('status');
    const btnEnable = document.getElementById('enableLoc');
    const inputCapture = document.getElementById('capture');
    const preview = document.getElementById('preview');
    const snapshot = document.getElementById('snapshot');
    let lat, lon;

    btnEnable.addEventListener('click', () => {
      statusEl.textContent = 'üåê Requesting location‚Ä¶';
      navigator.geolocation.getCurrentPosition(
        pos => {
          lat = pos.coords.latitude;
          lon = pos.coords.longitude;
          statusEl.textContent = '‚úÖ Location OK. You can now take a photo.';
          btnEnable.style.display = 'none';
          inputCapture.style.display = 'inline-block';
        },
        err => {
          statusEl.textContent = '‚ùå Location denied or unavailable. Please allow location.';
        },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    });

    // When user picks (or captures) an image:
    inputCapture.addEventListener('change', async e => {
      const file = e.target.files[0];
      if (!file) return;

      // Show a preview if you like:
      const url = URL.createObjectURL(file);
      snapshot.src = url;
      snapshot.style.display = 'block';

      // Now you would POST `file` plus {lat,lon} back to your bot server
      // via fetch(...) or Telegram WebApp.sendData(...)
      // e.g. Telegram Web App integration:
      // Telegram.WebApp.sendData(JSON.stringify({
      //   image: await fileToBase64(file), lat, lon
      // }));
    });

    // helper if you need Base64:
    async function fileToBase64(file) {
      return new Promise((res, rej) => {
        const reader = new FileReader();
        reader.onload = () => res(reader.result);
        reader.onerror = () => rej(reader.error);
        reader.readAsDataURL(file);
      });
    }
  </script>
</body>
</html>
